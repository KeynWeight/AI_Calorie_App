name: Deploy to Render

on:
  push:
    branches: [ master, main ]
    paths:
      - 'src/**'
      - 'streamlit_components/**'
      - 'app.py'
      - 'Dockerfile'
  workflow_dispatch: # Allow manual deployment

jobs:
  # First run our CI checks
  ci:
    uses: ./.github/workflows/ci.yml

  # Deploy only if CI passes
  deploy:
    needs: ci
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master' || github.ref == 'refs/heads/main'

    steps:
    - name: Deploy to Render
      uses: johnbeynon/render-deploy-action@v0.0.8
      with:
        service-id: ${{ secrets.RENDER_SERVICE_ID }}
        api-key: ${{ secrets.RENDER_API_KEY }}

    - name: Deployment Status
      run: |
        echo "ğŸš€ Deployment triggered successfully!"
        echo "ğŸ“± Your app will be available at: https://ai-calorie-app-agvf.onrender.com"
        echo "â±ï¸ Deployment usually takes 2-3 minutes"
